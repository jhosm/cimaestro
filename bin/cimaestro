#!/usr/bin/env ruby
require 'optparse'
require 'ostruct'
require 'Fileutils' 

options = OpenStruct.new

optparse = OptionParser.new do|opts|
  # Set a banner, displayed at the top
   # of the help screen.
   opts.banner = "Usage: cimaestro [options]"

  # Define the options, and what they do
   options.verbose = false
   opts.on( '-v', '--verbose', 'Output more information' ) do
     options.verbose = true
   end

  options.logfile = nil
  opts.on( '-l FILE', '--logfile FILE', 'Write log to FILE' ) do |file|
    options.logfile = file
  end

  # Define the options, and what they do
  options.setup = false
  opts.on( '-s', '--setup [GEM_HOME]', 'Setup cimaestro environment (via bundle install). If GEM_HOME is not specified, bundler''s default will be used.' ) do |gem_home|
    options.setup = true
    options.gem_home = gem_home || ''
  end

  # This displays the help screen, all programs are
  # assumed to have this option.
  opts.on( '-h', '--help', 'Display this screen' ) do
    puts opts
    exit
  end

end

optparse.parse!

puts "Being verbose" if options.verbose

if options.setup then
  FileUtils.cd(File.dirname(File.dirname(__FILE__)), :verbose => options.verbose) do |dir|
    cmd = "bundle install #{options.gem_home} --without development"
    puts cmd
    system cmd
  end
end
